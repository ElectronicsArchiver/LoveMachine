name: Boring maintenance stuff

on:
  schedule:
    - cron: 0 0 1 */2 *
  workflow_dispatch:

jobs:
  update_packages:
    runs-on: windows-2019
    
    env:
      ACTIONS_ALLOW_UNSECURE_COMMANDS: true

    steps:
    - name: Checkout Code
      uses: actions/checkout@v1
      
    - name: Setup MSBuild Path
      uses: warrenbuckley/Setup-MSBuild@v1
      
    - name: Setup dotnet
      uses: actions/setup-dotnet@v1
     
    - name: Install dotnet-outdated
      run: dotnet tool install --global dotnet-outdated
    
    - name: Run dotnet-outdated
      run: dotnet outdated --version-lock major --upgrade

    - name: Build and Publish
      run: msbuild BepInEx.LoveMachine.sln /p:Configuration=Release /p:DeployOnBuild=true /p:PublishProfile=FolderProfile

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v3
      with:
        commit-message: Update NuGet dependencies
        committer: github-actions[bot] <github-actions[bot]@users.noreply.github.com>
        author: github-actions[bot] <github-actions[bot]@users.noreply.github.com>
        branch: package-update
        base: mastur
        delete-branch: true
        title: 'Update NuGet dependencies'
        body: Bringing the latest and greatest of everything.
        assignees: Sauceke
        reviewers: Sauceke
